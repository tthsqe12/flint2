/*
    Copyright 2019 Daniel Schultz

    This file is part of FLINT.

    FLINT is free software: you can redistribute it and/or modify it under
    the terms of the GNU Lesser General Public License (LGPL) as published
    by the Free Software Foundation; either version 2.1 of the License, or
    (at your option) any later version.  See <http://www.gnu.org/licenses/>.
*/

#include <stdio.h>
#include <stdlib.h>
#include "profiler.h"
#include "fmpz_mpoly_factor.h"


slong check_omega(slong om, const fmpz_mpoly_t p, const fmpz_mpoly_ctx_t ctx)
{
    slong i;
    fmpz_mpoly_factor_t g;
    fmpz_t omega;
    timeit_t timer;

    fmpz_init(omega);
    fmpz_mpoly_factor_init(g, ctx);
/*
flint_printf("p: ");
fmpz_mpoly_print_pretty(p, NULL, ctx);
flint_printf("\n");
*/

    timeit_start(timer);
    fmpz_mpoly_factor(g, p, ctx);
    timeit_stop(timer);
/*
flint_printf("g: ");
fmpz_mpoly_factor_print_pretty(g, NULL, ctx);
flint_printf("\n");
*/

    fmpz_zero(omega);
    for (i = 0; i < g->num; i++)
        fmpz_add(omega, omega, g->exp + i);

    if (fmpz_cmp_si(omega, om) != 0)
    {
        flint_printf("factorization has wrong number of factors\n");
        flint_abort();
    }

    fmpz_mpoly_factor_clear(g, ctx);
    fmpz_clear(omega);

    return timer->wall;
}


int main(int argc, char *argv[])
{
    slong i, j, k;
    slong time, total_time = 0;

#if 0
    {
        fmpz_mpoly_t a;
        fmpz_mpoly_ctx_t ctx;
        fmpz_poly_t b;
        fmpz_mod_poly_t c;
        fmpz_mod_poly_factor_t f;
        fmpz_mod_ctx_t ctxp;
timeit_t timer;
        const char * vars[] = {"x"};

        fmpz_mpoly_ctx_init(ctx, 1, ORD_LEX);
        fmpz_mpoly_init(a, ctx);
        fmpz_mpoly_set_str_pretty(a, "x^96 - 6*x^95 + 18*x^94 + 5130*x^93 + 44307*x^92 + 47142*x^91 + 11935917*x^90 + 276537402*x^89 + 2061984519*x^88 + 23396237316*x^87 + 638307703053*x^86 + 8307301479120*x^85 + 74637008930700*x^84 + 1019197357418358*x^83 + 15442349497167447*x^82 + 169633154179687446*x^81 + 1648241589145457565*x^80 + 19044827090034375096*x^79 + 220921386809111870598*x^78 + 2183430634963451192358*x^77 + 19661079327650528580045*x^76 + 182197026078570435888702*x^75 + 1793302225858870131070098*x^74 + 15187697233689706034330592*x^73 + 103844229797383056784464444*x^72 + 773250491049241281239242134*x^71 + 5684796652279245877466837856*x^70 + 25323762981043304131098046122*x^69 + 29386254876246754589902545090*x^68 - 1047164708181946713755590027134*x^67 - 20373884726528949912730187199999*x^66 - 224914812022392386294639776944294*x^65 - 2016433534805182216368281169074241*x^64 - 17409776748250922417315220060691440*x^63 - 130566842087407769530278406702318311*x^62 - 717845143377305566214326868074627986*x^61 - 1907575766475565296420716277358273797*x^60 + 14552351814964404045842187073004610648*x^59 + 337293720344658249250959733868982971736*x^58 + 4306525502892931055366771488516647323856*x^57 + 44125433478301897244230432913977536154149*x^56 + 401769535962052674134537939150193258622146*x^55 + 3377386644486371364056141770115705071868907*x^54 + 26307798010211378184408742073740993248911802*x^53 + 197156334027432549160083894012068820417674604*x^52 + 1484325261588457051052047634543097182051170296*x^51 + 11284851781616241277408825715321904778970431524*x^50 + 84913890901122548019288412377713840937559282080*x^49 + 619790741528163401708445761604378307957897596636*x^48 + 4356861755561199413396053307453155657304100884778*x^47 + 29442906954982382942343046031538668502889932964197*x^46 + 192265180883018159469418128179641006658262910945356*x^45 + 1209804908723038764538899541923183273398862097462854*x^44 + 7194175925645111352199744121562455512696918864063854*x^43 + 39352353245867299746171150849608285606087309806517703*x^42 + 192770285949233663348649999058818235063335859914380052*x^41 + 832042258269077427576149234094762570292930442925142458*x^40 + 3168986017563620230856279982279168032830251799842777498*x^39 + 10885633821053256170965099991678800610385986917301162025*x^38 + 33929123353541769126205607467822942503631430135365442892*x^37 + 84729023242907286249486466595130804844877087658662592351*x^36 + 50603133761291947790470262384701139508683641929969233874*x^35 - 1088595782593368021211108934028659366066754734341034228730*x^34 - 7149425971705256737709768574975957874431109768602468013896*x^33 - 21828318752805486628722689229286585410035095443134569298658*x^32 - 5643218937546008378209377662533942415138842793838969785994*x^31 + 341034351826708449409145310692473873808786450951044146514410*x^30 + 2710318835184899982844714289855411733407395079989789187714166*x^29 + 17413642844638184065155315364941321275385671437795335779764812*x^28 + 107013635056552683199699091348778452547334555780349706422041374*x^27 + 577597218442985829190126841343451759188716471163227101741314900*x^26 + 2487341021213384313867788748443024646606650558658170633485617930*x^25 + 9276167129157514183816666930875697174488891266923925897184919470*x^24 + 36219110041533244033608877805489075349561076947121484084053543272*x^23 + 146244266188532592543047117420719669880785940114283187996531834200*x^22 + 554475430388581016337424444786465704070537321276257393399804619224*x^21 + 2004344580106739344497245151691612889769875332857998991979429929192*x^20 + 6050836700357692737635697769823508075492602172800055692898576910824*x^19 + 13970428345245319824111866261774550308969495212435825828136951392650*x^18 + 55335333497976997027057044601522524467016809062747861899684248050800*x^17 + 275044205956402760806680549101138213321645866355561655958883302608165*x^16 + 510021638939842722893017622927446616012204955174824097271659326369364*x^15 - 145864166728824991151814127160743047712727149542147674252883929995893*x^14 + 4285344213705739822750953163490583572542799800684509551481890609937912*x^13 + 22755738547151561552632158186323577639733726345420235230718793804973251*x^12 - 2036599102468718831931298013094113462410006932501649254454027797679830*x^11 - 30490864399820682408780354434823887714783485939555598610709868146166793*x^10 + 344631306616056729338215617771895693055426382434897246279458537390604232*x^9 + 316352989857148262382383352052802819241114911470157650333145203719657054*x^8 - 852508799820400987753120444063858162288974456278718829852331822393688024*x^7 + 2666053176186388926363527012312687421056792970977300692266674025657404727*x^6 + 3604682370770545423738945551713251547394384121815243339177416956640050878*x^5 - 6990658379942148665170338448445455499789850156097570967306489653441606245*x^4 + 17336555316140576979719374599669033565449442320518742900775834893012890226*x^3 + 19583095455898398543664521053668995791434600963895659650380131217946531168*x^2 - 48565075879217118481977295677131625636353167148753621009967881289082372974*x + 88365361457358472571994583782927776808836469277281111416604343883585184861", vars, ctx);
        flint_printf("a: ");
        fmpz_mpoly_print_pretty(a, vars, ctx);
        flint_printf("\n");

        fmpz_poly_init(b);
        fmpz_mpoly_get_fmpz_poly(b, a, 0, ctx);

        flint_printf("b: ");
        fmpz_poly_print_pretty(b, "x");
        flint_printf("\n");

        {
            fmpz_t p;
            fmpz_init(p);
            fmpz_set_str(p, "1513470582304237072513410067329391955423482356622077508836389416646889306993564534635830817676552455824162236150182627025523267446014684388515185452610872385131925014977944482910893194864870039450549067298170721939711827195277899152348801107671644590882157659897905715342306574668169658354699728703352747795407934837779271083755217530954282733292552820320384388452736605849854097009866199175847289532126439677946323677218741195176031143605520246681993939075046911841617410627221987267713724332646446061053160572807286503464245558500643221584631072641658731573097806459864337910226647829569494284055229751599736619753728848188090692318773574702174698843299086831373062575703757942149263399264787530048897154373819381136097105118607145954825590031647682047062652157439770794084025717418220995063370720546665168546633747096935011148065108431975289654040627344874607009807315363771104716985869481861040739858883444667635709902593581610755376089941291884120821811227210157156298148402819214731929270895508821230096451968194267364284229325768503489509991935215231081649023894346868133110803328310541268950321043061542938876190012860779210104580276403692887034246086754314279566458942937081999323928294877166406222310453677892068557340540597459094762172544492440478876793960002924059634516299394201455941482615164498572903667144188855598846763146090065079005267746644237582086328585101060359200085939560982221139190410290320736471223679431103604473374855519720454278533708018865824147794661166033633485429613879963993123931400014731049432239676739743030689374442267266097857265402044759137688500162237085777842605048998997700656346545264515630042484382164065996643359816205614528690639187167278480340820347644352745397902032133004265874403392556745361780498817583655041048101434716704942594567023160800649072971353", 10);
            fmpz_mod_ctx_init(ctxp, p);
            fmpz_clear(p);
            flint_printf("p: ");
            fmpz_print(fmpz_mod_ctx_modulus(ctxp));
            flint_printf("\n");
        }

        fmpz_mod_poly_init(c, ctxp);
        fmpz_mod_poly_set_fmpz_poly(c, b, ctxp);

        flint_printf("c: ");
        fmpz_mod_poly_print_pretty(c, "x", ctxp);
        flint_printf("\n");

timeit_start(timer);
        fmpz_mod_poly_factor_init(f, ctxp);
        fmpz_mod_poly_factor(f, c, ctxp);

flint_printf("f: ");
fmpz_mod_poly_factor_print(f, ctxp);
flint_printf("\n");

timeit_stop(timer);
flint_printf("time: %wd\n", timer->wall);

    }
#endif

    {
        fmpz_mpoly_ctx_t ctx;
        fmpz_mpoly_t a, b;
        timeit_t timer;
        const char * vars[] = {"x", "y", "z", "t"};

        fmpz_mpoly_ctx_init(ctx, 4, ORD_LEX);
        fmpz_mpoly_init(a, ctx);
        fmpz_mpoly_init(b, ctx);

        for (i = 1; i <= 24; i++)
        {
            fmpz_mpoly_set_str_pretty(b, "1+x+y+z+t", vars, ctx);
/*
flint_printf("b: ");
fmpz_mpoly_print_pretty(b, NULL, ctx);
flint_printf("\n");
*/
            fmpz_mpoly_pow_ui(b, b, i, ctx);
            fmpz_mpoly_add_ui(a, b, 2, ctx);
            fmpz_mpoly_add_ui(b, b, 3, ctx);

            timeit_start(timer);
            fmpz_mpoly_mul(a, a, b, ctx);
            timeit_stop(timer);

            k = (i > 0);
            for (j = 1; j <= i; j++)
                if ((j%2) != 0 && (i%j) == 0)
                    k++;

            time = check_omega(2, a, ctx);
            flint_printf("%wd: %wd %wd\n", i, time, timer->wall);
            total_time += time;
        }

        fmpz_mpoly_clear(a, ctx);
        fmpz_mpoly_clear(b, ctx);
        fmpz_mpoly_ctx_clear(ctx);
    }

    flint_printf("total_time: %wd\n", total_time);

    flint_cleanup_master();
    return 0;
}

